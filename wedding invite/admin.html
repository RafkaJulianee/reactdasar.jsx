<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Poppins', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .page { display: none; }
        .page.active { display: block; }
        .nav-link.active svg { color: #dc2626; /* red-600 */ }
        .nav-link.active span { color: #dc2626; /* red-600 */ }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-24">

    <!-- Header -->
    <header class="sticky top-0 bg-white/80 backdrop-blur-lg shadow-sm z-40">
        <div class="container mx-auto px-4 py-3">
            <h1 id="headerTitle" class="text-xl font-bold text-slate-800">Pesanan Masuk</h1>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4">
        <!-- Page: Orders -->
        <div id="page-orders" class="page active fade-in">
            <div id="orders-container" class="space-y-4"></div>
        </div>

        <!-- Page: Menu -->
        <div id="page-menu" class="page fade-in">
             <div id="menu-container" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
        </div>

        <!-- Page: Customers -->
        <div id="page-customers" class="page fade-in">
             <div id="customers-container" class="space-y-3"></div>
        </div>

        <!-- Page: Settings -->
        <div id="page-settings" class="page fade-in">
            <div class="space-y-6">
                <!-- Promo Banner Settings -->
                <div class="bg-white p-5 rounded-xl shadow-sm">
                    <h3 class="font-bold text-lg mb-4">Pengaturan Banner Promo</h3>
                    <form id="promo-form" class="space-y-3">
                        <input type="text" id="promoTitle" placeholder="Judul Promo (misal: Dapatkan Gratis!)" class="w-full rounded-lg border-slate-300">
                        <input type="text" id="promoSubtitle" placeholder="Subjudul (misal: Minuman dingin...)" class="w-full rounded-lg border-slate-300">
                        <button type="submit" class="w-full bg-red-600 text-white font-semibold py-2.5 rounded-lg">Simpan Promo</button>
                    </form>
                </div>
                 <!-- Category Settings -->
                <div class="bg-white p-5 rounded-xl shadow-sm">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">Kategori Menu</h3>
                        <button id="addCategoryBtn" class="bg-red-100 text-red-700 text-sm font-semibold px-3 py-1 rounded-full">+ Tambah</button>
                    </div>
                    <div id="categories-container" class="space-y-2"></div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Floating Action Button -->
    <button id="fab" class="fixed bottom-24 right-5 bg-red-600 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-3xl font-light transform hover:scale-110 transition-transform z-40">
        +
    </button>

    <!-- Bottom Navbar -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] z-50">
        <div class="flex justify-around items-center h-20">
            <button data-target="page-orders" class="nav-link active flex flex-col items-center justify-center w-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
                <span class="text-xs font-medium text-slate-500">Pesanan</span>
            </button>
            <button data-target="page-menu" class="nav-link flex flex-col items-center justify-center w-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
                <span class="text-xs font-medium text-slate-500">Menu</span>
            </button>
            <button data-target="page-customers" class="nav-link flex flex-col items-center justify-center w-full">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
                <span class="text-xs font-medium text-slate-500">Pelanggan</span>
            </button>
            <button data-target="page-settings" class="nav-link flex flex-col items-center justify-center w-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                <span class="text-xs font-medium text-slate-500">Pengaturan</span>
            </button>
        </div>
    </nav>

    <!-- Form Modal -->
    <div id="form-modal" class="hidden fixed inset-0 bg-black/50 z-[60] flex items-end">
        <div id="modal-content" class="bg-slate-50 w-full rounded-t-2xl slide-up">
            <div class="p-4 border-b">
                <div class="flex justify-between items-center">
                    <h2 id="modal-title" class="font-bold text-lg">Modal Title</h2>
                    <button id="close-modal-btn" class="text-2xl text-slate-500">&times;</button>
                </div>
            </div>
            <div class="p-4 max-h-[70vh] overflow-y-auto">
                <form id="main-form" class="space-y-4"></form>
            </div>
        </div>
    </div>

<script>
// NOTE: All state management is done via localStorage to simulate a backend.
// This allows communication between the buyer and admin pages.

document.addEventListener('DOMContentLoaded', () => {
    // --- STATE MANAGEMENT ---
    let state = {
        menu: [],
        orders: [],
        categories: [],
        customers: [], // Simple customer tracking
        settings: {
            promo: { title: 'Dapatkan Gratis!', subtitle: 'Minuman dingin di setiap pesanan burger.' }
        },
        activePage: 'page-orders'
    };

    // --- DOM ELEMENTS ---
    const pages = document.querySelectorAll('.page');
    const navLinks = document.querySelectorAll('.nav-link');
    const headerTitle = document.getElementById('headerTitle');
    const fab = document.getElementById('fab');
    // Containers
    const ordersContainer = document.getElementById('orders-container');
    const menuContainer = document.getElementById('menu-container');
    const customersContainer = document.getElementById('customers-container');
    const categoriesContainer = document.getElementById('categories-container');
    // Modal
    const formModal = document.getElementById('form-modal');
    const modalTitle = document.getElementById('modal-title');
    const mainForm = document.getElementById('main-form');
    const closeModalBtn = document.getElementById('close-modal-btn');
    
    // --- INITIALIZATION ---
    function loadState() {
        state.menu = JSON.parse(localStorage.getItem('menuItems')) || [{ id: 1, name: 'Buff Burger', price: 35000, image: 'https://assets.stickpng.com/images/580b57fcd9996e24bc43c1a8.png', category: 'Burger', points: 35, desc: 'Burger daging sapi juicy.' }];
        state.orders = JSON.parse(localStorage.getItem('orders')) || [];
        state.categories = JSON.parse(localStorage.getItem('categories')) || [{id: 1, name: 'Burger', icon: 'üçî'}, {id: 2, name: 'Pizza', icon: 'üçï'}];
        state.customers = JSON.parse(localStorage.getItem('customers')) || [{id: 'user1', name: 'Budi', points: 1250}];
        state.settings = JSON.parse(localStorage.getItem('storeSettings')) || state.settings;
        saveState();
    }

    function saveState() {
        localStorage.setItem('menuItems', JSON.stringify(state.menu));
        localStorage.setItem('orders', JSON.stringify(state.orders));
        localStorage.setItem('categories', JSON.stringify(state.categories));
        localStorage.setItem('customers', JSON.stringify(state.customers));
        localStorage.setItem('storeSettings', JSON.stringify(state.settings));
    }
    
    function initializeApp() {
        loadState();
        renderAll();
        setupEventListeners();
        // Periodically check for new orders from the buyer page
        setInterval(() => {
            const newOrders = JSON.parse(localStorage.getItem('orders')) || [];
            if (newOrders.length !== state.orders.length) {
                state.orders = newOrders;
                renderOrders();
            }
        }, 3000);
    }

    // --- RENDER FUNCTIONS ---
    function renderAll() {
        renderOrders();
        renderMenu();
        renderCustomers();
        renderSettings();
    }

    function renderOrders() {
        ordersContainer.innerHTML = state.orders.length === 0 
            ? `<p class="text-center text-slate-500 mt-8">Tidak ada pesanan masuk.</p>`
            : state.orders.map(order => `
                <div class="bg-white p-4 rounded-xl shadow-sm">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-bold">Pesanan #${order.id.slice(-5)}</p>
                            <p class="text-xs text-slate-500">${order.customerInfo.type === 'Online' ? order.customerInfo.address : `${order.customerInfo.name} - Meja ${order.customerInfo.table}`}</p>
                        </div>
                        <span class="text-xs font-semibold px-2 py-0.5 rounded-full ${order.status === 'Pending' ? 'bg-amber-100 text-amber-700' : 'bg-sky-100 text-sky-700'}">${order.status}</span>
                    </div>
                    <ul class="text-sm list-disc list-inside my-2 pl-2">
                        ${order.items.map(item => `<li>${item.quantity}x ${state.menu.find(m => m.id === item.id)?.name || 'Item Dihapus'}</li>`).join('')}
                    </ul>
                    <div class="border-t pt-2 flex justify-between items-center">
                        <p class="font-bold text-red-600">Rp ${order.total.toLocaleString('id-ID')}</p>
                        ${order.status === 'Pending' ? `<button data-id="${order.id}" class="confirm-order-btn bg-red-600 text-white text-sm font-semibold px-4 py-1.5 rounded-lg">Konfirmasi</button>` : ''}
                    </div>
                </div>
            `).join('');
    }

    function renderMenu() {
        menuContainer.innerHTML = state.menu.map(item => `
            <div class="bg-white p-3 rounded-xl shadow-sm flex items-start space-x-3">
                <img src="${item.image}" class="w-20 h-20 object-contain rounded-lg bg-slate-100 p-1">
                <div class="flex-1">
                    <p class="font-bold">${item.name}</p>
                    <p class="text-sm text-red-600 font-semibold">Rp ${item.price.toLocaleString('id-ID')}</p>
                    <p class="text-xs text-slate-500">${item.category}</p>
                </div>
                <div class="flex flex-col space-y-2">
                    <button data-id="${item.id}" class="edit-menu-btn text-slate-400">‚úèÔ∏è</button>
                    <button data-id="${item.id}" class="delete-menu-btn text-slate-400">üóëÔ∏è</button>
                </div>
            </div>
        `).join('');
    }
    
    function renderCustomers() {
        customersContainer.innerHTML = state.customers.map(c => `
             <div class="bg-white p-4 rounded-xl shadow-sm flex justify-between items-center">
                <div>
                    <p class="font-semibold">${c.name}</p>
                    <p class="text-xs text-slate-400">ID: ${c.id}</p>
                </div>
                <p class="font-bold text-amber-600">${c.points} Poin</p>
             </div>
        `).join('');
    }
    
    function renderSettings() {
        // Promo form
        document.getElementById('promoTitle').value = state.settings.promo.title;
        document.getElementById('promoSubtitle').value = state.settings.promo.subtitle;
        // Categories
        categoriesContainer.innerHTML = state.categories.map(cat => `
            <div class="bg-slate-100 p-2 rounded-lg flex justify-between items-center">
                <p>${cat.icon} ${cat.name}</p>
                <button data-id="${cat.id}" class="delete-category-btn text-red-500 text-sm font-semibold">Hapus</button>
            </div>
        `).join('');
    }

    // --- PAGE NAVIGATION ---
    function switchPage(targetPageId) {
        state.activePage = targetPageId;
        const pageTitles = {
            'page-orders': 'Pesanan Masuk',
            'page-menu': 'Kelola Menu',
            'page-customers': 'Data Pelanggan',
            'page-settings': 'Pengaturan'
        };
        headerTitle.textContent = pageTitles[targetPageId];

        pages.forEach(p => p.classList.toggle('active', p.id === targetPageId));
        navLinks.forEach(l => l.classList.toggle('active', l.dataset.target === targetPageId));
        
        // Show/hide FAB based on page
        fab.style.display = ['page-menu'].includes(targetPageId) ? 'flex' : 'none';
    }

    // --- MODAL & FORM HANDLING ---
    function openFormModal(mode, data = {}) {
        let formHTML = '';
        switch(mode) {
            case 'add-menu':
            case 'edit-menu':
                modalTitle.textContent = mode === 'add-menu' ? 'Tambah Menu Baru' : 'Edit Menu';
                formHTML = `
                    <input type="hidden" name="id" value="${data.id || ''}">
                    <input type="text" name="name" placeholder="Nama Makanan" class="w-full rounded-lg border-slate-300" value="${data.name || ''}" required>
                    <input type="number" name="price" placeholder="Harga" class="w-full rounded-lg border-slate-300" value="${data.price || ''}" required>
                    <input type="text" name="image" placeholder="URL Gambar" class="w-full rounded-lg border-slate-300" value="${data.image || ''}" required>
                    <select name="category" class="w-full rounded-lg border-slate-300" required>
                        ${state.categories.map(c => `<option value="${c.name}" ${data.category === c.name ? 'selected' : ''}>${c.name}</option>`).join('')}
                    </select>
                    <textarea name="desc" placeholder="Deskripsi" class="w-full rounded-lg border-slate-300">${data.desc || ''}</textarea>
                    <button type="submit" class="w-full bg-red-600 text-white font-semibold py-3 rounded-lg">Simpan Menu</button>
                `;
                break;
            case 'add-category':
                 modalTitle.textContent = 'Tambah Kategori';
                 formHTML = `
                    <input type="text" name="name" placeholder="Nama Kategori (misal: Minuman)" class="w-full rounded-lg border-slate-300" required>
                    <input type="text" name="icon" placeholder="Ikon Emoji (misal: üçπ)" class="w-full rounded-lg border-slate-300" required>
                    <button type="submit" class="w-full bg-red-600 text-white font-semibold py-3 rounded-lg">Simpan Kategori</button>
                 `;
                 break;
        }
        mainForm.innerHTML = formHTML;
        mainForm.dataset.mode = mode;
        formModal.classList.remove('hidden');
    }

    function handleFormSubmit(e) {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        const mode = e.target.dataset.mode;

        switch(mode) {
            case 'add-menu':
                state.menu.push({ ...data, id: Date.now(), price: Number(data.price) });
                break;
            case 'edit-menu':
                const menuIndex = state.menu.findIndex(item => item.id == data.id);
                if (menuIndex > -1) state.menu[menuIndex] = { ...state.menu[menuIndex], ...data, price: Number(data.price) };
                break;
            case 'add-category':
                state.categories.push({ ...data, id: Date.now() });
                break;
        }
        
        saveState();
        renderAll();
        formModal.classList.add('hidden');
    }

    // --- EVENT LISTENERS SETUP ---
    function setupEventListeners() {
        navLinks.forEach(link => link.addEventListener('click', () => switchPage(link.dataset.target)));
        fab.addEventListener('click', () => {
            if (state.activePage === 'page-menu') openFormModal('add-menu');
        });
        
        // Modal events
        closeModalBtn.addEventListener('click', () => formModal.classList.add('hidden'));
        mainForm.addEventListener('submit', handleFormSubmit);

        // Dynamic event listeners for generated content
        document.body.addEventListener('click', e => {
            if (e.target.matches('.confirm-order-btn')) {
                const orderId = e.target.dataset.id;
                const order = state.orders.find(o => o.id === orderId);
                if(order) {
                    order.status = 'Processing';
                    saveState();
                    renderOrders();
                }
            }
            if (e.target.matches('.edit-menu-btn')) {
                const item = state.menu.find(m => m.id == e.target.dataset.id);
                openFormModal('edit-menu', item);
            }
            if (e.target.matches('.delete-menu-btn')) {
                if (confirm('Yakin ingin menghapus menu ini?')) {
                    state.menu = state.menu.filter(m => m.id != e.target.dataset.id);
                    saveState();
                    renderMenu();
                }
            }
            if (e.target.matches('.delete-category-btn')) {
                 if (confirm('Yakin ingin menghapus kategori ini?')) {
                    state.categories = state.categories.filter(c => c.id != e.target.dataset.id);
                    saveState();
                    renderSettings();
                }
            }
             if (e.target.matches('#addCategoryBtn')) {
                openFormModal('add-category');
            }
        });

        // Settings form
        document.getElementById('promo-form').addEventListener('submit', e => {
            e.preventDefault();
            state.settings.promo.title = document.getElementById('promoTitle').value;
            state.settings.promo.subtitle = document.getElementById('promoSubtitle').value;
            saveState();
            alert('Info promo berhasil disimpan!');
        });
    }

    // --- START THE APP ---
    initializeApp();
});
</script>
</body>
</html>

