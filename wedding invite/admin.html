<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Sistem Pemesanan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="flex h-screen bg-slate-100 text-slate-800">
        <!-- Sidebar -->
        <div class="w-20 lg:w-64 bg-slate-900 text-white flex flex-col transition-all duration-300">
            <div class="px-4 lg:px-6 py-6 flex items-center justify-center lg:justify-start">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-sky-400 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
                </svg>
                <h2 class="text-2xl font-bold text-white ml-3 hidden lg:block">Admin</h2>
            </div>
            <nav class="flex-1 px-2 lg:px-4 py-4 space-y-2">
                <a href="#" data-target="dashboard" class="nav-link bg-slate-700 flex items-center justify-center lg:justify-start px-2 py-2.5 rounded-lg text-white font-semibold">
                    <svg class="h-6 w-6 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
                    <span class="ml-4 hidden lg:block">Pesanan</span>
                </a>
                <a href="#" data-target="add-food" class="nav-link hover:bg-slate-700 flex items-center justify-center lg:justify-start px-2 py-2.5 rounded-lg text-slate-300 hover:text-white transition-colors">
                    <svg class="h-6 w-6 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span class="ml-4 hidden lg:block">Tambah Menu</span>
                </a>
                 <a href="#" data-target="sales-data" class="nav-link hover:bg-slate-700 flex items-center justify-center lg:justify-start px-2 py-2.5 rounded-lg text-slate-300 hover:text-white transition-colors">
                    <svg class="h-6 w-6 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
                    <span class="ml-4 hidden lg:block">Penjualan</span>
                </a>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-4 md:p-8 overflow-y-auto">
            <!-- Dashboard/Pesanan Masuk -->
            <div id="dashboard" class="content-section fade-in">
                <h1 class="text-3xl font-bold text-slate-900 mb-6">Pesanan Masuk</h1>
                <div id="orders-container" class="space-y-5">
                    <!-- Orders will be injected here -->
                </div>
            </div>

            <!-- Tambah Makanan -->
            <div id="add-food" class="content-section hidden fade-in max-w-2xl mx-auto">
                <h1 class="text-3xl font-bold text-slate-900 mb-6">Tambah Menu Baru</h1>
                <div class="bg-white p-8 rounded-2xl shadow-lg">
                    <form id="add-food-form" class="space-y-5">
                        <div>
                            <label for="foodName" class="block text-sm font-medium text-slate-700">Nama Makanan</label>
                            <input type="text" id="foodName" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-sky-500 focus:ring-sky-500" required>
                        </div>
                        <div>
                            <label for="foodPrice" class="block text-sm font-medium text-slate-700">Harga (Rp)</label>
                            <input type="number" id="foodPrice" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-sky-500 focus:ring-sky-500" required>
                        </div>
                        <div>
                            <label for="foodImage" class="block text-sm font-medium text-slate-700">URL Gambar</label>
                            <input type="text" id="foodImage" placeholder="https://placehold.co/..." class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-sky-500 focus:ring-sky-500" required>
                        </div>
                         <div>
                            <label for="foodPoints" class="block text-sm font-medium text-slate-700">Poin yang didapat</label>
                            <input type="number" id="foodPoints" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-sky-500 focus:ring-sky-500" required>
                        </div>
                        <button type="submit" class="w-full bg-sky-500 text-white font-bold py-3 rounded-xl hover:bg-sky-600 transition duration-300">Tambah Menu</button>
                    </form>
                </div>
            </div>
            
            <!-- Data Penjualan -->
            <div id="sales-data" class="content-section hidden fade-in">
                 <h1 class="text-3xl font-bold text-slate-900 mb-6">Data Penjualan</h1>
                 <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-lg font-medium text-slate-500">Total Pendapatan</h3>
                        <p id="totalRevenue" class="text-3xl font-bold text-emerald-600 mt-2">Rp 0</p>
                    </div>
                     <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-lg font-medium text-slate-500">Pesanan Selesai</h3>
                        <p id="totalOrders" class="text-3xl font-bold text-sky-600 mt-2">0</p>
                    </div>
                     <div class="bg-white p-6 rounded-2xl shadow-lg">
                        <h3 class="text-lg font-medium text-slate-500">Menu Terlaris</h3>
                        <p id="bestSellingItem" class="text-xl font-bold text-amber-600 mt-2">-</p>
                    </div>
                 </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // STATE
    let menu = [];
    let orders = [];

    // DOM ELEMENTS
    const navLinks = document.querySelectorAll('.nav-link');
    const contentSections = document.querySelectorAll('.content-section');
    const ordersContainer = document.getElementById('orders-container');
    const addFoodForm = document.getElementById('add-food-form');

    function initializeAdmin() {
        menu = JSON.parse(localStorage.getItem('menuItems')) || [];
        orders = JSON.parse(localStorage.getItem('orders')) || [];
        
        renderOrders();
        updateSalesData();

        setInterval(() => {
            const currentOrders = JSON.parse(localStorage.getItem('orders')) || [];
            if(JSON.stringify(currentOrders) !== JSON.stringify(orders)) {
                orders = currentOrders;
                renderOrders();
                updateSalesData();
            }
        }, 3000);
    }

    function renderOrders() {
        const latestOrders = JSON.parse(localStorage.getItem('orders')) || [];
        ordersContainer.innerHTML = '';

        if (latestOrders.length === 0) {
            ordersContainer.innerHTML = '<div class="text-center bg-white p-8 rounded-2xl shadow-md"><p class="text-slate-500">Belum ada pesanan masuk.</p></div>';
            return;
        }

        const sortedOrders = latestOrders.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

        sortedOrders.forEach(order => {
            const statusStyles = {
                Pending: { border: 'border-amber-400', tagBg: 'bg-amber-100', tagText: 'text-amber-800' },
                Processing: { border: 'border-sky-500', tagBg: 'bg-sky-100', tagText: 'text-sky-800' },
                Completed: { border: 'border-emerald-500', tagBg: 'bg-emerald-100', tagText: 'text-emerald-800' }
            };
            const currentStatus = statusStyles[order.status] || statusStyles.Pending;

            const orderCard = document.createElement('div');
            orderCard.className = `bg-white p-5 rounded-2xl shadow-lg border-l-4 ${currentStatus.border}`;
            
            let customerDetails = '';
            if (order.customerInfo.type === 'Online') {
                customerDetails = `<p><strong class="font-medium text-slate-600">Alamat:</strong> ${order.customerInfo.address}</p>`;
            } else {
                customerDetails = `<p><strong class="font-medium text-slate-600">Nama:</strong> ${order.customerInfo.name}</p>
                                   <p><strong class="font-medium text-slate-600">No. Meja:</strong> ${order.customerInfo.table}</p>`;
            }

            let itemsList = order.items.map(item => {
                const menuItem = menu.find(m => m.id === item.id);
                const isFree = item.isFree ? ' <span class="text-xs text-amber-600">(Gratis)</span>' : '';
                return menuItem ? `<li class="text-slate-700">${menuItem.name} <span class="font-semibold">x ${item.quantity}</span>${isFree}</li>` : '';
            }).join('');
            
            orderCard.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="font-bold text-lg text-slate-800">Pesanan #${order.id.slice(-6)}</h3>
                        <p class="text-sm text-slate-500">${new Date(order.timestamp).toLocaleString('id-ID')}</p>
                    </div>
                    <span class="px-3 py-1 text-sm font-semibold rounded-full ${currentStatus.tagBg} ${currentStatus.tagText}">
                        ${order.status}
                    </span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm border-t pt-4">
                    <div class="space-y-1">
                        <h4 class="font-semibold text-slate-800 mb-1">Detail Pemesan:</h4>
                        ${customerDetails}
                        <p><strong class="font-medium text-slate-600">Catatan:</strong> ${order.customerInfo.notes || '-'}</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-slate-800 mb-1">Pesanan:</h4>
                        <ul class="list-disc list-inside pl-2">${itemsList}</ul>
                    </div>
                </div>
                <div class="mt-4 flex justify-between items-center border-t pt-4">
                    <p class="font-bold text-lg text-slate-800">Total: Rp ${order.total.toLocaleString('id-ID')}</p>
                    ${order.status === 'Pending' ? `<button data-id="${order.id}" class="confirm-order-btn bg-sky-500 text-white px-5 py-2 rounded-lg hover:bg-sky-600 font-semibold transition-colors">Konfirmasi</button>` : ''}
                </div>
            `;
            ordersContainer.appendChild(orderCard);
        });
    }

    function handleAddFood(e) {
        e.preventDefault();
        const newFood = {
            id: Date.now(),
            name: document.getElementById('foodName').value,
            price: parseInt(document.getElementById('foodPrice').value),
            image: document.getElementById('foodImage').value,
            points: parseInt(document.getElementById('foodPoints').value),
        };

        menu.push(newFood);
        localStorage.setItem('menuItems', JSON.stringify(menu));

        alert('Menu berhasil ditambahkan!');
        addFoodForm.reset();
    }
    
    function handleConfirmOrder(orderId) {
        const ordersData = JSON.parse(localStorage.getItem('orders')) || [];
        const orderIndex = ordersData.findIndex(o => o.id === orderId);
        if (orderIndex !== -1) {
            ordersData[orderIndex].status = 'Processing';
            localStorage.setItem('orders', JSON.stringify(ordersData));
            addNotificationToBuyer(`Pesanan #${orderId.slice(-6)} sedang diproses.`);
            renderOrders();
            updateSalesData();
        }
    }

    function addNotificationToBuyer(message) {
        const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        notifications.push({
            id: 'notif-' + Date.now(),
            message: message,
            timestamp: new Date().toISOString(),
            from: 'admin'
        });
        localStorage.setItem('notifications', JSON.stringify(notifications));
    }

    function updateSalesData() {
        const allOrders = JSON.parse(localStorage.getItem('orders')) || [];
        const completedOrders = allOrders.filter(o => o.status === 'Processing' || o.status === 'Completed');
        
        const totalRevenue = completedOrders.reduce((sum, order) => sum + order.total, 0);
        document.getElementById('totalRevenue').textContent = `Rp ${totalRevenue.toLocaleString('id-ID')}`;
        document.getElementById('totalOrders').textContent = completedOrders.length;
        
        if (completedOrders.length > 0) {
            const itemCounts = {};
            completedOrders.forEach(order => {
                order.items.forEach(item => {
                    if(!item.isFree) {
                        itemCounts[item.id] = (itemCounts[item.id] || 0) + item.quantity;
                    }
                });
            });

            if (Object.keys(itemCounts).length > 0) {
                const bestSellingId = Object.keys(itemCounts).reduce((a, b) => itemCounts[a] > itemCounts[b] ? a : b);
                const allMenuItems = JSON.parse(localStorage.getItem('menuItems')) || [];
                const bestSellingItem = allMenuItems.find(m => m.id == bestSellingId);
                document.getElementById('bestSellingItem').textContent = bestSellingItem ? bestSellingItem.name : 'N/A';
            } else {
                 document.getElementById('bestSellingItem').textContent = '-';
            }
        } else {
            document.getElementById('bestSellingItem').textContent = '-';
        }
    }

    // EVENT LISTENERS
    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.dataset.target;

            navLinks.forEach(l => {
                l.classList.remove('bg-slate-700', 'text-white');
                l.classList.add('text-slate-300', 'hover:text-white', 'hover:bg-slate-700');
            });
            link.classList.add('bg-slate-700', 'text-white');
            link.classList.remove('text-slate-300');

            contentSections.forEach(section => {
                section.id === targetId ? section.classList.remove('hidden') : section.classList.add('hidden');
            });
            
            if(targetId === 'dashboard') renderOrders();
            if(targetId === 'sales-data') updateSalesData();
        });
    });

    addFoodForm.addEventListener('submit', handleAddFood);

    ordersContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('confirm-order-btn')) {
            handleConfirmOrder(e.target.dataset.id);
        }
    });

    initializeAdmin();
});
</script>
</body>
</html>

